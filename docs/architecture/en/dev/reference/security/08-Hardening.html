<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <meta name="description" content=" ">

    <title>
	    AGL Developer Site - 
        
            
                Harden Configurations  -
            
        
    </title>

    <link rel="SHORTCUT ICON" href="/favicon.ico"/>

    

    
    

    <link rel="canonical" href="http://docs.automotivelinux.org/docs/architecture/en/dev/reference/security/08-Hardening.html">

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/static/styles/main.css">
    <link rel="stylesheet" type="text/css" href="/static/styles/syntax.css">
    <!-- Algolia Search CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />

    <!-- Fonts -->
    <!-- For attribution information, see www/attributions.html -->
    <link href='https://fonts.googleapis.com/css?family=Raleway:700,400,300,700italic,400italic,300italic' rel='stylesheet' type='text/css'>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- <script defer type="text/javascript">
        var disqus_developer = ; // this would set it to developer mode
    </script>-->

    <!-- JS -->
    <script defer type="text/javascript" src="/static/js/lib/jquery-2.1.1.min.js"></script>
    <script defer type="text/javascript" src="/static/js/lib/bootstrap.min.js"></script>
<!--    <script defer type="text/javascript" src="/static/js/lib/ZeroClipboard.js"></script>-->

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', '{}', 'auto');
    ga('send', 'pageview');
</script>

</head>

<body>
    <header>
    <a class="scroll-point pt-top" name="top"></a>
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="/"><img id="logo_top" src="/static/img/branding/agl_title_793x211.png"/></a>
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <div class="nav_bar_left">
                    <ul class="nav navbar-nav">
                        <li >
                            <a href="/docs/getting_started/en/dev/">Getting Started</a>
                        </li>
                                                
                        <li >
                            <a href="/docs/architecture/en/dev/">Architecture Guides</a>
                        </li>

                        <li >
                            <a href="/docs/hardware/en/dev/">Hardware Support</a>
                        </li>

                        <li >
                            <a href="/docs/devguides/en/dev/">Developer Guides</a>
                        </li>
                        
                        <li >
                            <a href="/docs/apis_services/en/dev/">APIs & Services</a>
                        </li>
					</ul>
				</div>
                <div class="nav_bar_right">
                    <ul class="nav navbar-nav">
                        <li >
                            <a href="/techpost" id="blog_button">TechPost<span class="badge" id="new_blog_count"></span></a>
                        </li>
                        <li >
                            <a href="/contribute">Contribute</a>
                        </li>
                        <li>
                            <form class="navbar-form navbar-right" id="header-search-form" role="search">
                                <div class="input-group">
                                    
                                    <input id="header-search-field" type="text" placeholder="Search 'dev' docs..." class="form-control hidden-xs" autocomplete="off">
                                </div>
                            </form>
                        </li>
                    </ul>
                </div>
            </div><!--/.navbar-collapse -->
        </div>
    </nav>
    <div id="_fixed_navbar_spacer" style="padding-top:50px"></div>
</header>














<div class="docs container">

    <!-- Table of Contents -->
    <div class="hidden-xs hidden-sm col-md-4 col-lg-3 site-toc-container">
        <ul class="site-toc">
    

    <li>
        
            <span class="toc-section-heading">
                AGL Specifications
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/AGL_Specifications/agl_spec_v1_280515.pdf">
                Automotive Grade Linux Requirements Specifications
            </a>
            
        

        
        

        
    </li>
    
</ul>

        
    </li>
    

    <li>
        
            <span class="toc-section-heading">
                Security Blueprint
            </span>
        

        
        

        
        <ul class="site-toc">
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/01-overview.html">
                Overview
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/02-threat-analysis.html">
                Threat Analysis
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/03-attack-surfaces.html">
                Attack Surfaces
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/04-adversaries.html">
                Adversaries
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/05-security-concepts.html">
                Security Concepts
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/06-plateform-security.html">
                Platform Security
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="" href="/docs/architecture/en/dev/reference/security/07-application-security.html">
                Application Security
            </a>
            
        

        
        

        
    </li>
    

    <li>
        
            <a class="this-page" href="/docs/architecture/en/dev/reference/security/08-Hardening.html">
                Harden Configurations
            </a>
            
                <span class="entry-highlight"></span>
            
        

        
        <div id="page-toc" class="page-toc"></div>

        
    </li>
    
</ul>

        
    </li>
    
</ul>

    </div>

    <!-- Page content -->
    <div class="col-md-8 col-md-offset-4 col-lg-9 col-lg-offset-3 page-content-container container">
        <div class="page-content row">
            <div class="col-md-offset-1 col-md-10">
                <div class="content-header">

                    <!-- ToC Dropdown (for XS and SM sizes only) -->
                    <div class="toc-dropdown dropdown visible-xs-block visible-sm-block">
                        <button class="btn btn-default dropdown-toggle" type="button" id="tocDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            Table of Contents
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            






<li>
    <a class="" href="reference/AGL_Specifications/agl_spec_v1_280515.pdf">
        Automotive Grade Linux Requirements Specifications
    </a>
</li>











<li>
    <a class="" href="reference/security/01-overview.html">
        Overview
    </a>
</li>




<li>
    <a class="" href="reference/security/02-threat-analysis.html">
        Threat Analysis
    </a>
</li>




<li>
    <a class="" href="reference/security/03-attack-surfaces.html">
        Attack Surfaces
    </a>
</li>




<li>
    <a class="" href="reference/security/04-adversaries.html">
        Adversaries
    </a>
</li>




<li>
    <a class="" href="reference/security/05-security-concepts.html">
        Security Concepts
    </a>
</li>




<li>
    <a class="" href="reference/security/06-plateform-security.html">
        Platform Security
    </a>
</li>




<li>
    <a class="" href="reference/security/07-application-security.html">
        Application Security
    </a>
</li>




<li>
    <a class="this-page" href="reference/security/08-Hardening.html">
        Harden Configurations
    </a>
</li>







                        </ul>
                    </div>

                    
                    
                        <a class="edit" href="https://github.com/automotive-grade-linux/docs-agl/edit/master/docs/sec-blueprint/08-Hardening.md"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit</a>

                    
                    

                    <!-- Language dropdown -->
                    <div class="dropdown">
                        <button class="btn btn-default dropdown-toggle" type="button" id="languageDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            
                            <span class="caret"></span>
                        </button>

                        <!-- List all languages -->
                        <ul class="dropdown-menu" aria-labelledby="languageDropdown">
                            
                        </ul>
                    </div>

                    <!-- Version dropdown -->
                    <div class="dropdown">
                        <button class="btn btn-default dropdown-toggle" type="button" id="versionDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            dev
                            
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="versionDropdown">

                            <!-- List versions available in this language -->
                            
                        </ul>
                    </div>
                </div>

                
                
                

                
                

                <!-- Show warnings for special versions -->
                <!-- dev warning -->
                
                    <div class="alert docs-alert alert-info" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        Draft version of documentation under development may change!
                        <a href="/docs/en/latest/">
                            Click here for the latest released version.
                        </a>
                    </div>
                
                
                <!-- outdated warning -->
                


                <div id="page-toc-source">
                    <!-- WARNING: This file is generated by fetch_docs.js using /w/workspace/sandbox-doc-update/webdocs-agl/site/_tocs/architecture/fetched_files.yml -->

<h1 id="overview">Overview</h1>

<h2 id="scope">Scope</h2>

<p>The information contained in this document is applicable to systems based
on Automotive Grade Linux.</p>

<h2 id="limitations">Limitations</h2>

<ul>
  <li>
    <p>This document is based on knowledge and research gained from looking
at security desktop and server versions of Linux as well as Android
exploits and hardening.</p>
  </li>
  <li>
    <p>Some kernel configuration options can have an impact on performance.<br />
This will be noted where applicable.­</p>
  </li>
</ul>

<h2 id="document-structure">Document Structure</h2>

<p>This document has been divided into three sections; REQUIREMENTS,
RECOMMENDATIONS, and VALIDATION. The REQUIREMENTS section details
explicit requirements that must be adhered to for the embedded
device.<br />
The RECOMMENDATIONS section details best practices, and some
recommended security settings for the embedded device. <br />
The third section, VALIDATION, provides reference scripts and test procedures that
can be used to verify adherence with the REQUIREMENTS detailed in the
first section of this guide.</p>

<h2 id="hardening">Hardening</h2>

<p>The term <em>Hardening</em> refers to the tools, techniques and processes
required in order to reduce the attack surface on an embedded system,
such as an embedded control unit (ECU) or other managed device.<br />
The target for all hardening activities is to prevent the execution of
invalid binaries on the device, and to prevent copying of security
related data from the device.<br />
There are three main areas of focus for hardening an embedded device:</p>

<h1 id="requirements">Requirements</h1>

<p>For the purposes of reference and explanation, we are providing guidance
  on how to configure an embedded device that runs with a linux 3. 10.17
  Linux kernel.<br />
  These requirements must still be met by manufacturers that
  opt to build using an alternative version of the Linux kernel.</p>

<h2 id="kernel-hardening">Kernel Hardening</h2>

<p>The following sub-sections contain information on various kernel
  configuration options to enhance the security measures in the kernel
  and also for applications compiled to take advantage of these security
  features.<br />
  Additionally, there are also configuration options that
  close known vulnerable configuration options.<br />
  Here’s a high level summary of various kernel configurations that 
  shall be required for deployment.</p>

<h3 id="disable-the-serial-console">Disable the serial console</h3>

<p>The serial console should be disabled to prevent an attacker from
  accessing this powerful interface.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_SERIAL_8250</span><span class="o">=</span>n
  <span class="nv">CONFIG_SERIAL_8250_CONSOLE</span><span class="o">=</span>n
  <span class="nv">CONFIG_SERIAL_CORE</span><span class="o">=</span>n
  <span class="nv">CONFIG_SERIAL_CORE_CONSOLE</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="restrict-access-to-kernel-memory-through-device-file">Restrict access to kernel memory through device file</h3>

<p>The /dev/kmem file in Linux systems is directly mapped to kernel
  virtual memory.<br />
  This can be disastrous if an attacker gains root
  access, as the attacker would have direct access to kernel virtual
  memory.</p>

<p>To disable the /dev/kmem file, which is very infrequently used by
  applications, the following kernel option should be set in the
  compile-time kernel configuration:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  CONFIG_DEVKMEM=n
</code></pre>
</div>

<p>In case applications in userspace need /dev/kmem support, it should be
  available only for authenticated applications.</p>

<h3 id="bake-in-the-kernel-command-line">Bake-in the kernel command-line</h3>

<p>The kernel command-line is used to control many aspects of the booting
  kernel, and is prone to tampering as they are passed in RAM with
  little to no reverse validation on these parameters.<br />
  To prevent this type of attack, the kernel shall be configured to ignore command line
  arguments, and use pre-configured (compile time) options instead.</p>

<p>Set the kernel command line in the CONFIG_CMDLINE KConfig item and
  then pass no arguments from the bootloader.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_CMDLINE_BOOL</span><span class="o">=</span>y
  <span class="nv">CONFIG_CMDLINE</span><span class="o">=</span>”&amp;lt;<span class="k">*</span>insert kernel <span class="nb">command </span>line here<span class="k">*</span>&amp;gt;”
  <span class="nv">CONFIG_CMDLINE_OVERRIDE</span><span class="o">=</span>y
</code></pre>
</div>

<p>It is recommended that any per-device settings (eg. MAC addresses,
  serial numbers, etc.) be stored and accessed from read-only memory (or
  files), and that any such parameters be verified (signature checking)
  prior to their use.</p>

<h3 id="disable-kernel-debug-symbols">Disable kernel debug symbols</h3>

<p>Debug symbols should always be removed from production kernels as they
  provide a lot of information to attackers.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_DEBUG_INFO</span><span class="o">=</span>n
</code></pre>
</div>

<p>These kernel debug symbols are enabled by other config items in the
  kernel.<br />
  Care should be taken to disable those also.<br />
  If CONFIG_DEBUG_INFO cannot be disabled then enabling
  CONFIG_DEBUG_INFO_REDUCED is second best.</p>

<h3 id="disable-access-to-a-kernel-core-dump">Disable access to a kernel core dump</h3>

<p>This kernel configuration disables access to a kernel core dump from
  user space – if enabled it gives attackers a useful view into kernel
  memory.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_PROC_KCORE</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-kgdb">Disable KGDB</h3>

<p>The Linux kernel supports KGDB over USB and console ports. These
  mechanisms are controlled by the kgdbdbgp and kgdboc kernel
  command-line parameters.<br />
  It is important to ensure that no shipping
  product contains a kernel with KGDB compiled-in.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_KGDB</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-kprobes">Disable Kprobes</h3>

<p>Kprobes enables you to dynamically break into any kernel routine and
  collect debugging and performance information non-disruptively.<br />
  You can trap at almost any kernel code address, specifying a handler
  routine to be invoked when the breakpoint is hit.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_KPROBES</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-tracing">Disable Tracing</h3>

<p>FTrace enables the kernel to trace every kernel function.<br />
  Providing kernel trace functionality would assist an attacker in discovering attack vectors.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_FTRACE</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-profiling">Disable Profiling</h3>

<p>Profiling and OProfile enables profiling the whole system, include the kernel,
  kernel modules, libraries, and applications.<br />
  Providing profiling functionality
  would assist an attacker in discovering attack vectors.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_OPROFILE</span><span class="o">=</span>n
  <span class="nv">CONFIG_PROFILING</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-magic-sysrq-support">Disable magic sysrq support</h3>

<p>On a few architectures, you can access a powerful debugger interface
  from the keyboard.<br />
  The same powerful interface can be present on the serial console 
  – responding to serial break – of Linux on other architectures.<br />
  Disable to avoid potentially exposing this powerful backdoor.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_MAGIC_SYSRQ</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-oops-print-on-bug">Disable OOPS print on BUG()</h3>

<p>The output from OOPS print can be helpful in Return Oriented
  Programming (ROP) when trying to determine the effectives of an
  exploit.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_DEBUG_BUGVERBOSE</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-kexec">Disable kexec</h3>

<p>This prevents someone who gets root from supplanting the kernel.<br />
  This can be used as a way to bypass signed kernels.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_KEXEC</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-kernel-ip-autoconfiguration">Disable kernel IP autoconfiguration</h3>

<p>It is preferable to have IP configuration performed using a user-space
  tool as these tend to have more validation.<br />
  We do not want the network
  interface coming up until the system has come up properly.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_IP_PNP</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-procconfiggz">Disable /proc/config.gz</h3>

<p>It is extremely important to not expose the kernel configuration used
  on a production device to a potential attacker.<br />
  With access to the
  kernel config, it could be possible for an attacker to build a custom
  kernel for the device that may disable critical security features.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_IKCONFIG</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-swap">Disable swap</h3>

<p>If not disabled, attackers can enable swap at runtime, add pressure to
  the memory subsystem and then scour the pages written to swap for
  useful information.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_SWAP</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-namespace-support">Disable namespace support</h3>

<p>Do not allow namespace support to prevent duplicates of dev nodes,
  pids and mount points.<br />
  This may be used in virtualization and container solutions like LXC, so in some cases it cannot be disabled.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_NAMESPACES</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-nfs-file-system">Disable NFS file system</h3>

<p>While often enabled in development, when left enabled in production
  builds this can be a very useful way for an attacker to get files onto
  and off of an STB.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_NFSD</span><span class="o">=</span>n
  <span class="nv">CONFIG_NFS_FS</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-support-for-binary-formats-other-than-elf">Disable support for binary formats other than ELF</h3>

<p>This will make possible to plug wrapper-driven binary formats into
  the kernel.<br />
  It enables support for binary formats other than ELF.<br />
  Providing the ability to use alternate interpreters would assist an attacker in
  discovering attack vectors</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_BINFMT_MISC</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-load-all-symbols">Disable “Load All Symbols”</h3>

<p>There is a /proc/kallsyms file which exposes the kernel memory space
  address of many kernel symbols (functions, variables, etc.).<br />
  This information is useful to attackers in identifying kernel
  versions/configurations and in preparing payloads for exploits of
  kernel space.</p>

<p>Both KALLSYMS_ALL and KALLSYMS shall be disabled;</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_KALLSYMS</span><span class="o">=</span>n
  <span class="nv">CONFIG_KALLSYMS_ALL</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-kernel-debugging">Disable Kernel Debugging</h3>

<p>There are development-only branches of code in the kernel enabled by
  the DEBUG_KERNEL conf.<br />
  This should be disabled to compile-out these branches.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_DEBUG_KERNEL</span><span class="o">=</span>n
</code></pre>
</div>

<p>In some kernel versions, disabling this requires also disabling
  CONFIG_EMBEDDED, and CONFIG_EXPERT Disabling CONFIG_EXPERT makes it
  impossible to disable _COREDUMP, DEBUG_BUGVERBOSE, _NAMESPACES,
  _KALLSYMS and _BUG.<br />
  In which case it is better to leave this enabled
  than enable the others.</p>

<h3 id="disable-the-kernel-debug-filesystem">Disable the kernel debug filesystem</h3>

<p>The kernel debug filesystem presents a lot of useful information and
  means of manipulation of the kernel to an attacker.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_DEBUG_FS</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-bug-support">Disable BUG() support</h3>

<p>The kernel will display backtrace and register information for BUGs
  and WARNs in kernel space, making it easier for attackers to develop
  exploits.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_BUG</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-sysctl-syscall-support">Disable Sysctl syscall support</h3>

<p>Enabling this will result in code being included that is hard to
  maintain and not well tested.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_SYSCTL_SYSCALL</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="kernel-modules">Kernel Modules</h3>

<h3 id="disable-module-unloading">Disable module unloading</h3>

<p>This stops an attacker unloading security focused kernel modules.<br />
  It will also prevent the attacker from removing evidence of any attempted
  kernel tampering that may have been initiated by loading of a kernel
  module.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_MODULE_UNLOAD</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-forced-module-loading">Disable Forced Module Loading</h3>

<p>If enabled, then modules without version information or with
  mismatched version information may be forcibly loaded into the kernel.<br />
  Disabling this configuration forces the attackers to build modules
  with matched kernel sources and configuration in order to load them.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_MODULE_FORCE_LOAD</span><span class="o">=</span>n
</code></pre>
</div>

<h1 id="recommendations">Recommendations</h1>

<p>The following sections detail best practices that should be applied in
order to secure a device.<br />
Although they are not currently listed as hard
requirements, they may be upgraded to requirements status in the future.</p>

<h2 id="kernel-hardening-1">Kernel Hardening</h2>

<p>The following sub-sections contain information on various kernel
  configuration options that will require updating to a newer kernel
  version in order to enhance the security measures in the kernel and
  also for applications compiled to take advantage of these security
  features.</p>

<p>Additionally, there are also configuration options that close known
  vulnerable configuration options.<br />
  Here’s a high level summary of the
  various kernel configurations and which kernel version they pertain:</p>

<table>
  <thead>
    <tr>
      <th>Kernel Configuration</th>
      <th>Kernel Version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CONFIG_CHECKPOINT_RESTORE=n</td>
      <td>3.3+</td>
    </tr>
    <tr>
      <td>CONFIG_UNIX_DIAG=n</td>
      <td>3.3+</td>
    </tr>
    <tr>
      <td>CROSS_MEMORY_ATTACH=n</td>
      <td>3.5+</td>
    </tr>
    <tr>
      <td>CONFIG_PANIC_ON_OOPS=y</td>
      <td>3.5+</td>
    </tr>
    <tr>
      <td>CONFIG_COREDUMP=n</td>
      <td>3.7+</td>
    </tr>
    <tr>
      <td>CONFIG_MODULE_SIG_FORCE=y</td>
      <td>3.7+</td>
    </tr>
    <tr>
      <td>CONFIG_PACKET_DIAG=n</td>
      <td>3.7+</td>
    </tr>
    <tr>
      <td>CONFIG_FW_LOADER_USER_HELPER=n</td>
      <td>3.9+</td>
    </tr>
    <tr>
      <td>CONFIG_CC_STACKPROTECTOR=y</td>
      <td>3.11+ (MIPS)</td>
    </tr>
    <tr>
      <td>CONFIG_USELIB=n</td>
      <td>3.15+</td>
    </tr>
    <tr>
      <td>BPF_JIT=n</td>
      <td>3.16+ (MIPS)</td>
    </tr>
    <tr>
      <td>CONFIG_DEVMEM=n</td>
      <td>4.0+</td>
    </tr>
  </tbody>
</table>

<h3 id="build-with-stack-protection">Build with Stack Protection</h3>

<p>Similar to the stack protector used for ELF programs in user-space,
  the kernel can protect its internal stacks as well.<br />
  This configuration for the MIPS architecture is supported in Linux 3.11 and greater and
  thus should only be enabled for such versions.<br />
  This configuration also
  requires building the kernel with the gcc compiler 4.2 or greater.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_CC_STACKPROTECTOR</span><span class="o">=</span>y
</code></pre>
</div>

<h3 id="disable-access-to-devmem">Disable access to /dev/mem</h3>

<p>The /dev/mem file in Linux systems is directly mapped to physical
  memory.<br />
  This can be disastrous if an attacker gains root access, as
  the attacker would have direct access to physical memory through this
  convenient device file.<br />
  It may not always be possible to disable such
  file, as some applications might need such support.<br />
  In that case then
  this device file should be available only for authenticated
  applications.<br />
  This configuration is supported in Linux 4.0 and greater
  and thus should only be disabled for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_DEVMEM</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-cross-memory-attach">Disable cross-memory attach</h3>

<p>Disable the process_vm_*v syscalls which allow one process to
  peek/poke the virtual memory of another.<br />
  This configuration is
  supported in Linux 3.5 and greater and thus should only be disabled
  for such versions.
<code class="highlighter-rouge">bash
  CROSS_MEMORY_ATTACH=n
</code></p>

<h3 id="disable-core-dumps">Disable core dumps</h3>

<p>Core dumps provide lot of debug information for hackers.<br />
  So disabling core dumps is recommended in production builds.<br />
  This configuration is
  supported in Linux 3.7 and greater and thus should only be disabled
  for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_COREDUMP</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-legacy-linux-support">Disable Legacy Linux Support</h3>

<p>There are some Kernel Configs which are present only to support legacy
  binaries.<br />
  See also section 2.2.2.18 for disabling support for legacy binary formats.<br />
  The uselib system call, in particular, has no valid use in any libc6 or uclibc system in recent times.<br />
  This configuration is supported in Linux 3.15 and greater and thus should only be
  disabled for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_USELIB</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-firmware-auto-loading-user-mode-helper">Disable firmware auto-loading user mode helper</h3>

<p>The firmware auto loading helper, which is a utility executed by the
  kernel on hotplug events requiring firmware, needs to be set setuid.<br />
  As a result of this, the helper utility is an attractive target for
  attackers with control of physical ports on the device.<br />
  Disabling this configuration is supported in Linux 3.9 and greater.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_FW_LOADER_USER_HELPER</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="enable-kernel-panic-on-oops">Enable Kernel Panic on OOPS</h3>

<p>When fuzzing the kernel or attempting kernel exploits attackers are
  likely to trigger kernel OOPSes.<br />
  Setting the behavior on OOPS to PANIC can impede their progress.<br />
  This configuration is supported in Linux 3.5 and greater and thus should only be enabled for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_PANIC_ON_OOPS</span><span class="o">=</span>y
</code></pre>
</div>

<h3 id="disable-socket-monitoring-interface">Disable socket monitoring interface</h3>

<p>These monitors can be used to inspect shared file descriptors on Unix
  Domain sockets or traffic on ‘localhost’ which is otherwise assumed to
  be confidential.<br />
  The <strong>CONFIG_PACKET_DIAG</strong> configuration is supported in Linux 3.7 and greater and thus should only be disabled
  for such versions.<br />
  The <strong>CONFIG_UNIX_DIAG</strong> configuration is
  supported in Linux 3.3 and greater and thus should only be disabled
  for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_PACKET_DIAG</span><span class="o">=</span>n
  <span class="nv">CONFIG_UNIX_DIAG</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-bpf-jit">Disable BPF JIT</h3>

<p>The BPF JIT can be used to create kernel-payloads from firewall table
  rules.<br />
  This configuration for the MIPS architecture is supported in
  Linux 3.16 and greater and thus should only be disabled for such
  versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">BPF_JIT</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="disable-checkpointrestore">Disable checkpoint/restore</h3>

<p>The checkpoint/restore service can take a process, freeze it and
  migrate it.<br />
  This results in providing more info than a core dump.<br />
  This configuration is supported in Linux 3.3 and greater and thus should
  only be disabled for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_CHECKPOINT_RESTORE</span><span class="o">=</span>n
</code></pre>
</div>

<h3 id="enable-enforced-module-signing">Enable Enforced Module Signing</h3>

<p>This configuration is supported in Linux 3.7 and greater and thus
  should only be enabled for such versions.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_MODULE_SIG_FORCE</span><span class="o">=</span>y
</code></pre>
</div>

<h3 id="disable-all-usb-pcmcia-and-other-hotplug-bus-drivers-that-arent-needed">Disable all USB, PCMCIA (and other hotplug bus) drivers that aren’t needed</h3>

<p>To reduce the attack surface, the driver enumeration, probe, and
  operation happen in the kernel.<br />
  The driver data is parsed by the kernel, so any logic bugs in these drivers can become kernel exploits.</p>

<h3 id="disable-all-file-systems-not-needed">Disable all file systems not needed</h3>

<p>To reduce the attack surface; file system data is parsed by the kernel
  so any logic bugs in file system drivers can become kernel exploits.</p>

<h3 id="kernel-address-display-restriction">Kernel Address Display Restriction</h3>

<p>When attackers try to develop “run anywhere” exploits for kernel
  vulnerabilities, they frequently need to know the location of internal
  kernel structures.<br />
  By treating kernel addresses as sensitive information, those locations are not visible to regular local users.</p>

<p>/proc/sys/kernel/kptr_restrict is set to “1” to block the reporting
  of known kernel address leaks.</p>

<p>Additionally, various files and directories should be readable only by
  the root user: /boot/vmlinuz*, /boot/System.map*,
  /sys/kernel/debug/, /proc/slabinfo</p>

<h3 id="dmesg-restrictions">DMESG Restrictions</h3>

<p>When attackers try to develop “run anywhere” exploits for
  vulnerabilties, they frequently will use dmesg output.<br />
  By treating dmesg output as sensitive information, this output is not available to
  the attacker.</p>

<p>/proc/sys/kernel/dmesg_restrict can be set to “1” to treat dmesg
  output as sensitive.</p>

<h3 id="selinux">SELinux</h3>

<p>If SELinux is in use on the embedded system, the following kernel
  options should be enabled to prevent SELlinux from being disabled at
  either runtime or boot time.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nv">CONFIG_SECURITY_SELINUX_DEVELOP</span><span class="o">=</span>n
  <span class="nv">CONFIG_SECURITY_SELINUX_DISABLE</span><span class="o">=</span>n
  <span class="nv">CONFIG_SECURITY_SELINUX_BOOTPARAM</span><span class="o">=</span>n
</code></pre>
</div>

<h1 id="validation">Validation</h1>

<h2 id="image-security-analysis-framework-isafw">Image Security Analysis Framework (ISAFW)</h2>
<p><strong>meta-security-isafw</strong> is an OE layer that allows enabling the Image
Security Analysis Framework (isafw) for your image builds.</p>

<p>The primary purpose of isafw is to provide an extensible
framework for analysing different security aspects of images
during the build process.</p>

<p>The isafw project itself can be found at
    https://github.com/01org/isafw</p>

<p>This layer can be added to your builds to produce an analysis report,
including a kernel config analysis.</p>

<h3 id="usage">Usage</h3>

<p>In order to enable the isafw during the image build, please add
the following line to your build/conf/local.conf file:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">INHERIT</span> <span class="o">+=</span> <span class="s">"isafw"</span>
</code></pre>
</div>



                </div>
            </div>
        </div>
        <div class="row">
            <div class="blue-divider"></div>
<footer>
    <div class="container-fluid">
        <div class="row">
    <div class="col-sm-9">
        <h1>More Resources</h1>
        <div class="row">
            <div class="col-sm-4">
                <h2>General</h2>
                <ul class="nav">
                    <li>
                        <a target="_blank" href="https://www.automotivelinux.org/">AGL Developer Community</a>
                    </li>
                    <li>
                        <a href="https://www.automotivelinux.org/software/download/">Download Distribution</a>
                    </li>
                    <li>
                        <a href="https://gerrit.automotivelinux.org/gerrit/#/admin/projects/">Source Code on Git</a>
                    </li>
                    <li>
                        <a target="_blank" href="/contact">Mailing List</a>
                    </li>
                </ul>
            </div>
            <div class="col-sm-4">
                <h2>Development</h2>
                <ul class="nav">
                    <li><a target="_blank" href="https://wiki.automotivelinux.org/agl-distro/source-code">Source Code</a></li>
                    <li><a target="_blank" href="https://jira.automotivelinux.org/browse/SPEC/?selectedTab=com.atlassian.jira.jira-projects-plugin:summary-panel">Issue Tracker</a></li>
                    <li><a target="_blank" href="https://wiki.automotivelinux.org/">Wiki</a></li>
                    <li><a href="https://www.automotivelinux.org/contact-us">Contact</a></li>
                </ul>
            </div>
            <div class="col-sm-4">
                <h2>Automotive Grade Linux @ Linux Foundation</h2>
                <ul class="nav">
                    <li>
                        <a target="_blank" href="https://www.automotivelinux.org/">About AGL</a>
                    </li>
                    <li>
                        <a target="_blank" href="http://www.linuxfoundation.org/">About Linux Foundation</a>
                    </li>
                    <li>
                        <a target="_blank" href="https://wiki.automotivelinux.org/start/getting-started">Join AGL community</a>
                    </li>
                    <li>
                        <a target="_blank" href="https://www.automotivelinux.org/about/members">Members</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-sm-3">
        <h1>Contribute</h1>
        <p style="padding-top:20px"><strong>Help AGL move forward!</strong></p>
        <p>Report bugs, improve the docs, or contribute to the code.</p>
        <a href="/contribute" class="btn btn-lg btn-primary">
            Learn More
        </a>
        <p style="padding-top:20px"> <a href="https://twitter.com/autogradelinux" class="twitter-follow-button" data-show-count="false">Follow @autogradelinux</a></p>
    </div>
</div>
<div class="row">
	<div class="col-sm-9">
		<p class="copyright_text">
			Copyright &copy; 2015-2016 Automotive Grade Linux Documentation, Licensed under the <a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
			<br/>
			Automotive Grade Linux and logos are <a target="_blank" href="http://www.linuxfoundation.org">trademarks</a> of The Linux Foundation.
			<br/>
			Initial site design from <a href="https://cordova.apache.org/">Cordova website.</a> - warm thanks !
		</p>
	</div>
    <div class="col-sm-3">
		<small class="stats">Page rendered at:  2016-12-26 00:02:24 +0000</small>
		
		<br/><small class="stats"><a href="https://raw.githubusercontent.com/automotive-grade-linux/docs-agl/master/docs/sec-blueprint/08-Hardening.md">Link to source document</small>
		
	</div>
</div>

    </div>
</footer>

        </div>
    </div>
</div>

<script defer type="text/javascript" src="/static/js/lib/toc.min.js"></script>
<script defer type="text/javascript" src="/static/js/docs.js"></script>

    <script defer type="text/javascript" src="/static/js/twitter.js"></script>
    



<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<script type="text/javascript">
    docsearch({
        apiKey: 'edd30bcff9f6df4b095c41cba3e5a418',
        indexName: 'automotivelinux',
        inputSelector: '#header-search-field',
    });
</script>

            
    

</body>
</html>
